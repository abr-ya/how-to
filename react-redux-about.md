# Redax, он же с Реактом, человеческим языком
Не так давно я в очередной раз прикручивал Ридакс к проекту на Реакте, и по ходу дела написал себе шпаргалку. А потом у меня возник вопрос: понял бы я эту шпаргалку, если бы сейчас начинал работать с Ридакс? Думаю, нет. И я решил написать немного текста про то, зачем и как всё это.

## Паттерн Flux
Много раз нам сказали, что Redux - лишь одна из реализаций паттерна Flux. Мне, например, нравится ![вот эта статья](https://habr.com/ru/company/hexlet/blog/268249/), и отдельно - комментарии к ней. Но я хочу порассуждать про Ридакс в Реакт приложении не с точки зрения паттерна, а с т.з. разработчика, у которого "было без Ридакса, а надо - с".

## Как было
Это реальный кейс. У нас есть приложение. Есть роутер и страницы: общая, с каким-то списком карточек (новости, картинки, у меня - фильмы) и детальная. Дальше каждая из этих страниц:
- использует хук useEffect - срабатывает на загрузку и изменение параметров запроса,
- при срабатывании хука выполняется запрос - возвращает промис,
- в then мы помещаем результат запроса в State страницы,
- изменение стейта приводит к перерисовки страницы.

Вроде бы всё легко и просто. Но в большом проекте, видимо, в этом можно закопаться. Кроме того, одни и те же данные могут быть нужны нам в совершенно разных частях проекта, кроме того, стронно 3 раза за 5 минут открывая страницу, например, фильма, каждый раз отправлять запрос на данные о нём.

## Появляется Redux
- ![Redux](https://redux.js.org/)
- ![React Redux](https://react-redux.js.org/)

Как в связи с этим должно измениться наше приложение?
Ридакс используется для создания глобального стейта приложения. Этот стейт может меняться в разных местах приложения, и использоваться также в разных местах. Особенностью работы с ним является то, что из приложения стейт не меняется напрямую - для этого есть специальный инструмент - actions - экшены. В сети есть много картинок со стрелочками. Попробую обойтись без них.

## Основные элементы
Обозначим с чем мы работаем:
- Store - глобальный стейт приложения, хранимый "в Ридакс", обладает рядом методов,
- Action - экшен - объект, который вызывается в приложении и вызывают изменение Стейта,
- Dispather - диспетчер (? - переводится вообще) - связка экшена в приложении со Store, который он должен изменить - происходит при вызове функции коннект при создании контейнера или в момент вызова метода Store [подробнее](https://redux.js.org/api/store#dispatchaction). По сути, связывает экшн с редюсером,
- Reducer - редюсер - функция, которая принимает текущий стейт и экшен и возвращает новый стейт, важно: новый стейт, а не мутированный старый.

## Изменение данных
Пока что будем считать, что у нас есть компонент, и в него, как пропсы, попадают экшены и значения из Стейта. Допустим, мы нажали на кнопочку "+1". Что происходит в приложении:
- вызывается экшен, который мы привязали к кнопке,
- экшен вызывает редюсер, который получает команду: возьми стейт и увеличь значение на 1,
- редюсер изменяет стейт,
- после этого в компонент как свойство приходит новое значение и вызывает перерисовку компонента.

## Время практики
В этом месте я понял, что на словах - сложно. И пора что-то в коде написать. Итак, допустим файлы Ридакса уже закинуты в наш проект по инструкции. Создадим вторую простую страничку, на которой будет самый примитивный счётчик, положим его значение в Ридакс и обеспечим работу с ним.

Я создал самую простую страницу для демо:

```javascript
import React from 'react';
import Counter from './Counter';

const ReduxDemo = () => (
  <div className="container">
    <h1>Для тестов Redux 2</h1>
    <Counter />
  </div>
);

export default ReduxDemo;
```

и подключил её в роутер в App.

А также - чистый компонент Counter:

```javascript
import React from 'react';

const Counter = () => {
  console.log('counter');

  return (
    <div>Counter</div>
  );
};

export default Counter;
```

в этой же папке.
Вот как это выглядит:
![](./img/redux2/2021-08-18_190929_start.png)

Подготовим "испытательный полигон" - в компоненте создадим карточку, пару кнопок и место для вывода значения. У меня уже подключен бутстрап, поэтому я использую его классы. Других стилей не будет, чтобы не отвлекаться:

```javascript
    <div className="card mt-3">
      <div className="card-body">
        <h5 className="card-title">
          Counter
        </h5>
        <button className="btn btn-primary" type="button">+1</button>
        <div>...</div>
        <button className="btn btn-danger" type="button">-1</button>
      </div>
    </div>
```

Как это выглядит:
![](./img/redux2/2021-08-18_191838_buttons.png)



![](./img/redux2/)